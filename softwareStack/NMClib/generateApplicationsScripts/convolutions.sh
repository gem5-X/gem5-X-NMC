#!/bin/bash

DEST_DIR="$(pwd)/debug_SSDResNet34_DDR4/cnm_conv"
mkdir -p "$DEST_DIR"

conv_args_list=(
    "-D HI=224 -D WI=224 -D CI=3 -D K=7 -D CO=64 -D PADDING=3 -D STRIDE=2 -o debug_conv1_DDR4"
    "-D HI=56 -D WI=56 -D CI=64 -D K=1 -D CO=256 -D PADDING=0 -D STRIDE=1 -o debug_res2a_branch1_DDR4"
    "-D HI=56 -D WI=56 -D CI=64 -D K=1 -D CO=64 -D PADDING=0 -D STRIDE=1 -o debug_res2a_branch2a_DDR4"
    "-D HI=56 -D WI=56 -D CI=64 -D K=3 -D CO=64 -D PADDING=1 -D STRIDE=1 -o debug_res2a_branch2b_DDR4"
    # "-D HI=56 -D WI=56 -D CI=64 -D K=1 -D CO=256 -D PADDING=0 -D STRIDE=1 -o debug_res2a_branch2c_DDR4"
    "-D HI=56 -D WI=56 -D CI=256 -D K=1 -D CO=64 -D PADDING=0 -D STRIDE=1 -o debug_res2b_branch2a_DDR4"
    # "-D HI=56 -D WI=56 -D CI=64 -D K=3 -D CO=64 -D PADDING=1 -D STRIDE=1 -o debug_res2b_branch2b_DDR4"
    # "-D HI=56 -D WI=56 -D CI=64 -D K=1 -D CO=256 -D PADDING=0 -D STRIDE=1 -o debug_res2b_branch2c_DDR4"
    # "-D HI=56 -D WI=56 -D CI=256 -D K=1 -D CO=64 -D PADDING=0 -D STRIDE=1 -o debug_res2c_branch2a_DDR4"
    # "-D HI=56 -D WI=56 -D CI=64 -D K=3 -D CO=64 -D PADDING=1 -D STRIDE=1 -o debug_res2c_branch2b_DDR4"
    # "-D HI=56 -D WI=56 -D CI=64 -D K=1 -D CO=256 -D PADDING=0 -D STRIDE=1 -o debug_res2c_branch2c_DDR4"
    "-D HI=56 -D WI=56 -D CI=256 -D K=1 -D CO=512 -D PADDING=0 -D STRIDE=2 -o debug_res3a_branch1_DDR4"
    "-D HI=56 -D WI=56 -D CI=256 -D K=1 -D CO=128 -D PADDING=0 -D STRIDE=2 -o debug_res3a_branch2a_DDR4"
    "-D HI=28 -D WI=28 -D CI=128 -D K=3 -D CO=128 -D PADDING=1 -D STRIDE=1 -o debug_res3a_branch2b_DDR4"
    "-D HI=28 -D WI=28 -D CI=128 -D K=1 -D CO=512 -D PADDING=0 -D STRIDE=1 -o debug_res3a_branch2c_DDR4"
    "-D HI=28 -D WI=28 -D CI=512 -D K=1 -D CO=128 -D PADDING=0 -D STRIDE=1 -o debug_res3b_branch2a_DDR4"
    # "-D HI=28 -D WI=28 -D CI=128 -D K=3 -D CO=128 -D PADDING=1 -D STRIDE=1 -o debug_res3b_branch2b_DDR4"
    # "-D HI=28 -D WI=28 -D CI=128 -D K=1 -D CO=512 -D PADDING=0 -D STRIDE=1 -o debug_res3b_branch2c_DDR4"
    # "-D HI=28 -D WI=28 -D CI=512 -D K=1 -D CO=128 -D PADDING=0 -D STRIDE=1 -o debug_res3c_branch2a_DDR4"
    # "-D HI=28 -D WI=28 -D CI=128 -D K=3 -D CO=128 -D PADDING=1 -D STRIDE=1 -o debug_res3c_branch2b_DDR4"
    # "-D HI=28 -D WI=28 -D CI=128 -D K=1 -D CO=512 -D PADDING=0 -D STRIDE=1 -o debug_res3c_branch2c_DDR4"
    # "-D HI=28 -D WI=28 -D CI=512 -D K=1 -D CO=128 -D PADDING=0 -D STRIDE=1 -o debug_res3d_branch2a_DDR4"
    # "-D HI=28 -D WI=28 -D CI=128 -D K=3 -D CO=128 -D PADDING=1 -D STRIDE=1 -o debug_res3d_branch2b_DDR4"
    # "-D HI=28 -D WI=28 -D CI=128 -D K=1 -D CO=512 -D PADDING=0 -D STRIDE=1 -o debug_res3d_branch2c_DDR4"
    "-D HI=28 -D WI=28 -D CI=512 -D K=1 -D CO=1024 -D PADDING=0 -D STRIDE=2 -o debug_res4a_branch1_DDR4"
    "-D HI=28 -D WI=28 -D CI=512 -D K=1 -D CO=256 -D PADDING=0 -D STRIDE=2 -o debug_res4a_branch2a_DDR4"
    "-D HI=14 -D WI=14 -D CI=256 -D K=3 -D CO=256 -D PADDING=1 -D STRIDE=1 -o debug_res4a_branch2b_DDR4"
    "-D HI=14 -D WI=14 -D CI=256 -D K=1 -D CO=1024 -D PADDING=0 -D STRIDE=1 -o debug_res4a_branch2c_DDR4"
    "-D HI=14 -D WI=14 -D CI=1024 -D K=1 -D CO=256 -D PADDING=0 -D STRIDE=1 -o debug_res4b_branch2a_DDR4"
    # "-D HI=14 -D WI=14 -D CI=256 -D K=3 -D CO=256 -D PADDING=1 -D STRIDE=1 -o debug_res4b_branch2b_DDR4"
    # "-D HI=14 -D WI=14 -D CI=256 -D K=1 -D CO=1024 -D PADDING=0 -D STRIDE=1 -o debug_res4b_branch2c_DDR4"
    # "-D HI=14 -D WI=14 -D CI=1024 -D K=1 -D CO=256 -D PADDING=0 -D STRIDE=1 -o debug_res4c_branch2a_DDR4"
    # "-D HI=14 -D WI=14 -D CI=256 -D K=3 -D CO=256 -D PADDING=1 -D STRIDE=1 -o debug_res4c_branch2b_DDR4"
    # "-D HI=14 -D WI=14 -D CI=256 -D K=1 -D CO=1024 -D PADDING=0 -D STRIDE=1 -o debug_res4c_branch2c_DDR4"
    # "-D HI=14 -D WI=14 -D CI=1024 -D K=1 -D CO=256 -D PADDING=0 -D STRIDE=1 -o debug_res4d_branch2a_DDR4"
    # "-D HI=14 -D WI=14 -D CI=256 -D K=3 -D CO=256 -D PADDING=1 -D STRIDE=1 -o debug_res4d_branch2b_DDR4"
    # "-D HI=14 -D WI=14 -D CI=256 -D K=1 -D CO=1024 -D PADDING=0 -D STRIDE=1 -o debug_res4d_branch2c_DDR4"
    # "-D HI=14 -D WI=14 -D CI=1024 -D K=1 -D CO=256 -D PADDING=0 -D STRIDE=1 -o debug_res4e_branch2a_DDR4"
    # "-D HI=14 -D WI=14 -D CI=256 -D K=3 -D CO=256 -D PADDING=1 -D STRIDE=1 -o debug_res4e_branch2b_DDR4"
    # "-D HI=14 -D WI=14 -D CI=256 -D K=1 -D CO=1024 -D PADDING=0 -D STRIDE=1 -o debug_res4e_branch2c_DDR4"
    # "-D HI=14 -D WI=14 -D CI=1024 -D K=1 -D CO=256 -D PADDING=0 -D STRIDE=1 -o debug_res4f_branch2a_DDR4"
    # "-D HI=14 -D WI=14 -D CI=256 -D K=3 -D CO=256 -D PADDING=1 -D STRIDE=1 -o debug_res4f_branch2b_DDR4"
    # "-D HI=14 -D WI=14 -D CI=256 -D K=1 -D CO=1024 -D PADDING=0 -D STRIDE=1 -o debug_res4f_branch2c_DDR4"
    "-D HI=14 -D WI=14 -D CI=1024 -D K=1 -D CO=2048 -D PADDING=0 -D STRIDE=2 -o debug_res5a_branch1_DDR4"
    "-D HI=14 -D WI=14 -D CI=1024 -D K=1 -D CO=512 -D PADDING=0 -D STRIDE=2 -o debug_res5a_branch2a_DDR4"
    "-D HI=7 -D WI=7 -D CI=512 -D K=3 -D CO=512 -D PADDING=1 -D STRIDE=1 -o debug_res5a_branch2b_DDR4"
    "-D HI=7 -D WI=7 -D CI=512 -D K=1 -D CO=2048 -D PADDING=0 -D STRIDE=1 -o debug_res5a_branch2c_DDR4"
    "-D HI=7 -D WI=7 -D CI=2048 -D K=1 -D CO=512 -D PADDING=0 -D STRIDE=1 -o debug_res5b_branch2a_DDR4"
    # "-D HI=7 -D WI=7 -D CI=512 -D K=3 -D CO=512 -D PADDING=1 -D STRIDE=1 -o debug_res5b_branch2b_DDR4"
    # "-D HI=7 -D WI=7 -D CI=512 -D K=1 -D CO=2048 -D PADDING=0 -D STRIDE=1 -o debug_res5b_branch2c_DDR4"
    # "-D HI=7 -D WI=7 -D CI=2048 -D K=1 -D CO=512 -D PADDING=0 -D STRIDE=1 -o debug_res5c_branch2a_DDR4"
    # "-D HI=7 -D WI=7 -D CI=512 -D K=3 -D CO=512 -D PADDING=1 -D STRIDE=1 -o debug_res5c_branch2b_DDR4"
    # "-D HI=7 -D WI=7 -D CI=512 -D K=1 -D CO=2048 -D PADDING=0 -D STRIDE=1 -o debug_res5c_branch2c_DDR4"
)

for conv_args in "${conv_args_list[@]}"; do
    g++ -std=c++11 -O3 main.cpp -I /cnm-framework/pim-cores/cnmlib/include -L /cnm-framework/pim-cores/cnmlib/util/m5 -lm5 -lpthread -Wall -DCONV $conv_args
    sshpass -p "vlMoDwsg9d" scp $(echo "$conv_args" | awk -F'-o ' '{print $2}') kodra@eslsrv11.epfl.ch:/home/kodra/shares/local/scrap/gem5-x-cnm/applications/debug_SSDResNet34_DDR4/cnm_conv
done